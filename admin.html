<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Turf Master | Professional Admin Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Bebas+Neue&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --primary: #32ff7e;
            --accent: #ff6b35;
            --dark: #0a0f0d;
            --dark2: #111a14;
            --sidebar-w: 260px;
            --glass: rgba(255, 255, 255, 0.03);
            --border: rgba(255, 255, 255, 0.08);
            --text: #e8f5ee;
            --muted: rgba(232, 245, 238, 0.5);
            --danger: #ff4757;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--dark);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            overflow: hidden;
        }

        /* ‚îÄ‚îÄ Login Overlay ‚îÄ‚îÄ */
        #loginSection {
            position: fixed;
            inset: 0;
            background: var(--dark);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1.5rem;
        }

        #loginSection::before {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(ellipse 80% 60% at 70% 10%, rgba(50, 255, 126, 0.06) 0%, transparent 60%);
            pointer-events: none;
        }

        .login-card {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 3rem;
            width: 100%;
            max-width: 420px;
            text-align: center;
        }

        .login-logo {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 3rem;
            letter-spacing: 4px;
            margin-bottom: 0.5rem;
        }

        .login-logo span {
            border-bottom: 4px solid var(--primary);
        }

        /* ‚îÄ‚îÄ Sidebar ‚îÄ‚îÄ */
        .sidebar {
            width: var(--sidebar-w);
            background: var(--dark2);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            transition: transform 0.3s;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 2rem 1.5rem;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.8rem;
            letter-spacing: 2px;
            color: var(--primary);
            flex-shrink: 0;
        }

        .nav-links {
            flex: 1;
            padding: 0 1rem;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            margin-bottom: 0.5rem;
            border-radius: 12px;
            color: var(--muted);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .nav-item:hover,
        .nav-item.active {
            color: var(--text);
            background: var(--glass);
        }

        .nav-item.active {
            border-left: 3px solid var(--primary);
            color: var(--primary);
        }

        .sidebar-footer {
            padding: 1.5rem;
            border-top: 1px solid var(--border);
            margin-top: auto;
            flex-shrink: 0;
        }

        /* ‚îÄ‚îÄ Main Content ‚îÄ‚îÄ */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow-y: auto;
            position: relative;
        }

        .top-bar {
            height: 70px;
            padding: 0 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--border);
            background: rgba(10, 15, 13, 0.5);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .content-area {
            padding: 2.5rem;
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
        }

        /* ‚îÄ‚îÄ Dashboard Cards ‚îÄ‚îÄ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2.5rem;
        }

        .stat-card {
            background: var(--glass);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .stat-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--muted);
        }

        .stat-value {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2.5rem;
            color: var(--text);
        }

        .stat-footer {
            font-size: 0.75rem;
            color: var(--primary);
        }

        /* ‚îÄ‚îÄ Forms & Tables ‚îÄ‚îÄ */
        .section-header {
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .section-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.8rem;
            letter-spacing: 2px;
        }

        .table-wrap {
            background: var(--glass);
            border: 1px solid var(--border);
            border-radius: 20px;
            overflow: hidden;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            text-align: left;
            padding: 1rem 1.5rem;
            font-size: 0.75rem;
            text-transform: uppercase;
            color: var(--muted);
            border-bottom: 1px solid var(--border);
        }

        td {
            padding: 1rem 1.5rem;
            font-size: 0.9rem;
            border-bottom: 1px solid var(--border);
        }

        tr:last-child td {
            border-bottom: none;
        }

        .search-input {
            background: var(--glass);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 0.7rem 1.2rem;
            border-radius: 50px;
            outline: none;
            font-family: inherit;
            min-width: 300px;
            transition: all 0.3s;
        }

        .search-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(50, 255, 126, 0.1);
        }

        /* ‚îÄ‚îÄ UI Elements ‚îÄ‚îÄ */
        .btn-action {
            padding: 0.5rem 1rem;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text);
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-action:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .badge {
            padding: 0.2rem 0.6rem;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .badge-success {
            background: rgba(50, 255, 126, 0.15);
            color: var(--primary);
        }

        .badge-pending {
            background: rgba(255, 171, 0, 0.15);
            color: #ffab00;
        }

        /* ‚îÄ‚îÄ Specific Overlays ‚îÄ‚îÄ */
        .loading-overlay {
            position: absolute;
            inset: 0;
            background: rgba(10, 15, 13, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 50;
        }

        @media (max-width: 900px) {
            .sidebar {
                position: fixed;
                left: 0;
                top: 0;
                bottom: 0;
                z-index: 1000;
                transform: translateX(-100%);
            }

            .sidebar.active {
                transform: translateX(0);
            }
        }
    </style>
</head>

<body>

    <!-- ‚îÄ‚îÄ LOGIN ‚îÄ‚îÄ -->
    <div id="loginSection">
        <div class="login-card">
            <div class="login-logo">TURF <span>MASTER</span></div>
            <p style="color: var(--muted); font-size: 0.8rem; margin-bottom: 2.5rem; letter-spacing: 2px;">ADMINISTRATOR
                ACCESS</p>

            <div style="text-align: left; margin-bottom: 1.5rem;">
                <label
                    style="font-size: 0.7rem; font-weight: 700; color: var(--muted); text-transform: uppercase; display: block; margin-bottom: 0.5rem;">Username</label>
                <input type="text" id="username" placeholder="admin"
                    style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 12px; color: white; outline: none;"
                    onkeydown="if(event.key==='Enter') login()" />
            </div>

            <div style="text-align: left; margin-bottom: 2rem;">
                <label
                    style="font-size: 0.7rem; font-weight: 700; color: var(--muted); text-transform: uppercase; display: block; margin-bottom: 0.5rem;">Password</label>
                <input type="password" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                    style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 12px; color: white; outline: none;"
                    onkeydown="if(event.key==='Enter') login()" />
            </div>

            <button onclick="login()"
                style="width: 100%; padding: 1.2rem; background: var(--primary); color: var(--dark); border: none; border-radius: 50px; font-family: 'Bebas Neue', sans-serif; font-size: 1.2rem; cursor: pointer; transition: 0.3s;">UNLOCK
                DASHBOARD ‚Üí</button>
            <p id="loginError" style="color: var(--danger); font-size: 0.8rem; margin-top: 1rem; display: none;">‚ö†
                Invalid credentials.</p>
        </div>
    </div>

    <!-- ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">TURF ADMIN</div>
        <nav class="nav-links">
            <div class="nav-item active" onclick="showSection('overview')">
                <span>üè†</span> Overview
            </div>
            <div class="nav-item" onclick="showSection('registrations')">
                <span>üë§</span> People Registered
            </div>
            <div class="nav-item" onclick="showSection('pricing')">
                <span>üí∞</span> Pricing Desk
            </div>
        </nav>
        <div class="sidebar-footer">
            <button onclick="logout()" class="btn-action"
                style="width: 100%; color: var(--danger); border-color: rgba(255,71,87,0.2);">‚èè Sign Out</button>
        </div>
    </aside>

    <!-- ‚îÄ‚îÄ MAIN CONTENT ‚îÄ‚îÄ -->
    <main class="main-content">
        <header class="top-bar">
            <button class="btn-action" id="menuToggle" style="padding: 0.5rem; display: none;">‚ò∞</button>
            <div style="font-size: 0.9rem; font-weight: 500;">Welcome, <span style="color: var(--primary);">Boss</span>
            </div>
            <div id="systemIndicator"
                style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.7rem; color: var(--muted);">
                <span style="width: 8px; height: 8px; border-radius: 50%; background: var(--primary);"></span>
                SYSTEM ACTIVE
            </div>
        </header>

        <div class="content-area">

            <!-- OVERVIEW SECTION -->
            <section id="section_overview">
                <div class="section-header">
                    <h2 class="section-title">DASHBOARD <span>OVERVIEW</span></h2>
                    <button onclick="loadDashboardStats()" class="btn-action">‚Üª Refresh Data</button>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <span class="stat-label">Today's Bookings</span>
                        <div class="stat-value" id="stat_today">...</div>
                        <span class="stat-footer">Daily activity</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-label">Total Revenue</span>
                        <div class="stat-value" id="stat_revenue">...</div>
                        <span class="stat-footer">Lifetime earnings</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-label">Total Clients</span>
                        <div class="stat-value" id="stat_users">...</div>
                        <span class="stat-footer">Unique customers</span>
                    </div>
                </div>

                <div class="stat-card" style="margin-top: 2rem; border-color: rgba(50, 255, 126, 0.15);">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div>
                            <span class="stat-label">Drive Folder Connection</span>
                            <div id="folderStatus" style="font-size: 1.2rem; font-weight: 600; margin-top: 0.5rem;">
                                Checking connection...</div>
                        </div>
                        <button onclick="checkDriveAccess()" class="btn-action" style="font-size: 0.7rem;">Validate
                            Access</button>
                    </div>
                </div>
            </section>

            <!-- REGISTRATIONS SECTION -->
            <section id="section_registrations" style="display: none;">
                <div class="section-header">
                    <h2 class="section-title">PEOPLE <span>REGISTERED</span></h2>
                    <input type="text" id="regSearch" placeholder="Search name or mobile..." class="search-input"
                        oninput="filterRegistrations()" />
                </div>

                <div style="margin-bottom: 2rem; display: flex; align-items: center; gap: 1rem;">
                    <div style="display: flex; flex-direction: column; gap: 0.3rem;">
                        <label style="font-size: 0.7rem; color: var(--muted); font-weight: 700;">FILTER BY DATE</label>
                        <input type="date" id="regFilterDate" onchange="loadRegistrations()"
                            style="padding: 0.7rem; background: var(--glass); border: 1px solid var(--border); border-radius: 8px; color: white; outline: none;" />
                    </div>
                </div>

                <div class="table-wrap">
                    <table id="regTable">
                        <thead>
                            <tr>
                                <th>Client Name</th>
                                <th>Mobile</th>
                                <th>Age</th>
                                <th>Slots Booked</th>
                                <th>Payment</th>
                            </tr>
                        </thead>
                        <tbody id="regTableBody">
                            <tr>
                                <td colspan="5" style="text-align: center; padding: 4rem; color: var(--muted);">Select a
                                    date above to load data.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- PRICING SECTION -->
            <section id="section_pricing" style="display: none;">
                <div class="section-header">
                    <h2 class="section-title">PRICING <span>DESK</span></h2>
                    <p style="color: var(--muted); font-size: 0.8rem;">Adjust slot rates for specific days</p>
                </div>
                <div id="pricingTable" style="display: grid; gap: 1rem;">
                    <p class="loading-row">Loading pricing data...</p>
                </div>
            </section>

        </div>
    </main>

    <script src="script.js"></script>
    <script>
        const SESSION_KEY = "turf_admin_session";
        let allRegistrations = [];

        // ‚îÄ‚îÄ Session & Init ‚îÄ‚îÄ
        window.onload = function () {
            if (sessionStorage.getItem(SESSION_KEY) === "true") {
                showDashboard();
            }
        };

        function showDashboard() {
            document.getElementById("loginSection").style.display = "none";
            loadDashboardStats();
            checkDriveAccess();
        }

        // ‚îÄ‚îÄ Navigation ‚îÄ‚îÄ
        function showSection(id) {
            document.querySelectorAll('section').forEach(s => s.style.display = 'none');
            document.getElementById(`section_${id}`).style.display = 'block';

            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            document.querySelector(`.nav-item[onclick*="${id}"]`).classList.add('active');

            if (id === 'pricing') loadPrices();
            if (id === 'overview') loadDashboardStats();
        }

        // ‚îÄ‚îÄ Stats & Drive Check ‚îÄ‚îÄ
        async function loadDashboardStats() {
            try {
                const res = await fetch(`${SCRIPT_URL}?action=fetchDashboardStats`, { redirect: 'follow' });
                const data = await res.json();
                if (data.status === "success") {
                    document.getElementById("stat_today").innerText = data.stats.todayBookings;
                    document.getElementById("stat_revenue").innerText = "‚Çπ" + data.stats.totalRevenue.toLocaleString();
                    document.getElementById("stat_users").innerText = data.stats.totalUsers;
                }
            } catch (e) { console.error("Stats Error:", e); }
        }

        async function checkDriveAccess() {
            const el = document.getElementById("folderStatus");
            el.innerText = "üîç Checking folder...";
            try {
                const res = await fetch(`${SCRIPT_URL}?action=checkDriveFolder`, { redirect: 'follow' });
                const data = await res.json();
                if (data.status === "success") {
                    el.innerHTML = `‚úÖ Linked to: <span style="color: var(--primary)">${data.folderName}</span>`;
                } else {
                    el.innerHTML = `‚ùå <span style="color: var(--danger)">${data.message}</span>`;
                }
            } catch (e) { el.innerText = "‚ùå Connection failed"; }
        }

        // ‚îÄ‚îÄ Registrations ‚îÄ‚îÄ
        async function loadRegistrations() {
            const date = document.getElementById('regFilterDate').value;
            const tbody = document.getElementById('regTableBody');
            if (!date) return;

            tbody.innerHTML = `<tr><td colspan="5" style="text-align: center; padding: 4rem;">Syncing from sheet...</td></tr>`;

            try {
                const res = await fetch(`${SCRIPT_URL}?action=fetchRegistrations&date=${date}`, { redirect: 'follow' });
                const data = await res.json();
                if (data.status === "success") {
                    allRegistrations = data.registrations;
                    renderRegistrations(allRegistrations);
                }
            } catch (e) {
                tbody.innerHTML = `<tr><td colspan="5" style="text-align: center; padding: 4rem; color: var(--danger);">Connection error.</td></tr>`;
            }
        }

        function filterRegistrations() {
            const q = document.getElementById('regSearch').value.toLowerCase();
            const filtered = allRegistrations.filter(r =>
                r.name.toLowerCase().includes(q) ||
                r.mobile.toString().includes(q)
            );
            renderRegistrations(filtered);
        }

        function renderRegistrations(list) {
            const tbody = document.getElementById('regTableBody');
            if (!list || list.length === 0) {
                tbody.innerHTML = `<tr><td colspan="5" style="text-align: center; padding: 4rem; color: var(--muted);">No matches found.</td></tr>`;
                return;
            }
            tbody.innerHTML = list.map(reg => `
                <tr>
                    <td><div style="font-weight: 600;">${reg.name}</div></td>
                    <td><span style="color: var(--muted); font-family: monospace;">${reg.mobile}</span></td>
                    <td>${reg.age}</td>
                    <td style="font-size: 0.8rem; line-height: 1.4; color: var(--muted);">${reg.slots}</td>
                    <td><span class="badge ${reg.status.toLowerCase() === 'success' ? 'badge-success' : 'badge-pending'}">${reg.status}</span></td>
                </tr>
            `).join('');
        }

        // ‚îÄ‚îÄ Pricing Logic (Same as before but with better UI) ‚îÄ‚îÄ
        async function loadPrices() {
            const table = document.getElementById("pricingTable");
            table.innerHTML = '<p class="loading-row">Reaching pricing service...</p>';
            try {
                const res = await fetch(`${SCRIPT_URL}?action=fetchPricing`, { redirect: 'follow' });
                const data = await res.json();
                if (data.status === "success") {
                    const pricing = {};
                    Object.keys(data.pricing).forEach(k => { pricing[k.toLowerCase()] = data.pricing[k]; });

                    const days = ["monday", "tuesday", "wednesday", "thursday", "friday", "saturday", "sunday"];
                    table.innerHTML = days.map(d => {
                        const price = pricing[d] || 500;
                        return `
                            <div style="display: flex; align-items: center; justify-content: space-between; padding: 1.2rem; background: var(--glass); border: 1px solid var(--border); border-radius: 12px;">
                                <div style="text-transform: capitalize; font-weight: 600;">${d}</div>
                                <div style="display: flex; align-items: center; gap: 1rem;">
                                    <span style="color: var(--primary); font-weight: 700;">‚Çπ</span>
                                    <input type="number" id="price_${d}" value="${price}" style="width: 100px; padding: 0.5rem; background: var(--dark); border: 1px solid var(--border); border-radius: 6px; color: white; text-align: right;" />
                                    <button class="btn-action" onclick="savePrice('${d}')" id="btn_${d}">Update</button>
                                </div>
                            </div>
                        `;
                    }).join('');
                }
            } catch (e) { table.innerHTML = '<p>Error loading pricing.</p>'; }
        }

        async function savePrice(dayKey) {
            const btn = document.getElementById(`btn_${dayKey}`);
            const price = document.getElementById(`price_${dayKey}`).value;
            btn.innerText = "‚è≥";
            try {
                const res = await fetch(SCRIPT_URL, {
                    method: "POST",
                    body: JSON.stringify({ action: "updatePricing", day: dayKey, price: price }),
                    redirect: "follow"
                });
                const result = await res.json();
                btn.innerText = result.status === "success" ? "‚úì Done" : "‚ùå Err";
                setTimeout(() => btn.innerText = "Update", 2000);
            } catch (e) { btn.innerText = "‚ùå Err"; }
        }

        // ‚îÄ‚îÄ Auth ‚îÄ‚îÄ
        function login() {
            const u = document.getElementById("username").value.trim();
            const p = document.getElementById("password").value;
            if (u === ADMIN_USERNAME && p === ADMIN_PASSWORD) {
                sessionStorage.setItem(SESSION_KEY, "true");
                showDashboard();
            } else {
                document.getElementById("loginError").style.display = "block";
            }
        }

        function logout() {
            sessionStorage.removeItem(SESSION_KEY);
            location.reload();
        }
    </script>
</body>

</html>